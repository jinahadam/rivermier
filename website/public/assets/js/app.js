$(document).ready(function(){function m(a,b,c){$(a).hide();$(b).show();$(".navbar").find(".active").removeClass("active");$('a[href="'+c+'"]').closest("li").addClass("active")}function l(a){return/haveeru\.com\.mv\/dhivehi|sun\.mv\/\d|manadhoolive|newdhivehiobserver|moonlight\.com\.mv|cnm\.com\.mv|dhitv\.com\.mv/.test(a)}function k(){twttr.anywhere(function(a){a.hovercards({expanded:true})});twttr.anywhere(function(a){a("strong > a").hovercards({expanded:true,username:function(a){return a.title}})})}function j(a,b){var c=/#\w+|(?:https?|ftp):\/\/.*?\..*?(?=\W?(\s|$))/gi,d=$(a);var e,f=0;c.lastIndex=0;while(e=c.exec(b)){d.append($("<span/>").text(b.slice(f,e.index)));if(e[0].slice(0,1)=="#"){d.append($("<a/>").attr("href","http://twitter.com/search/"+encodeURIComponent(e[0].slice(1))).attr("target","_blank").text(e[0]))}else{d.append($("<a/>").attr("href",e[0]).attr("target","_blank").text(e[0]))}f=c.lastIndex}d.append($("<span/>").text(b.slice(f)))}function i(a){$(a).find(".tweet-text").each(function(){var a=$(this).find(".original-text").text();j(this,a)});$(a).find(".time").each(function(){$(this).timeago()});k()}function h(a,b,c,d){$(b).closest(".tweet").find(".time").timeago();j(b,c);k();if(d==undefined||d==false){g(a)}}function g(a){var b=1;var c=1;var d="#"+$(a).parent().attr("id")+"-button";var e=$(d).text().match(/\d*(\D+)/)[1];if($(d+" > .badge").text().length!=0){var b=b+parseInt($(d+" > .badge").text())}if($("title").text().match(/\((\w+)\)/)){var c=c+parseInt($("title").text().match(/\((\w+)\)/)[1])}$("title").text("("+c+") Rivermier | Dhivehi Tweets and Trends");$("#live-stream-button").html("<span class='badge badge-info'>"+c+"</span>Live Stream");$(d).html("<span class='badge badge-info'>"+b+"</span>"+e);if($(a+" > .load-more").length==0){$(a).prepend('<div class="load-more load-button well">Show New Tweets</div>')}$(a+" > .load-more").bind("click",function(){var b=0;$(this).remove();$(a+" > .hide").show();$(d+" > .badge").remove();$(".live-stream-nav").find("li > a > .badge").each(function(){$(this).text();b=b+parseInt($(this).text())});if(b>0){$("title").text("("+b+") Rivermier | Dhivehi Tweets and Trends");$("#live-stream-button").html("<span class='badge badge-info'>"+b+"</span>Live Stream")}else{$("title").text("Rivermier | Dhivehi Tweets and Trends");$("#live-stream-button").html("Live Stream")}})}function e(a){$("#videos > .tweets").prepend('<div class="hide row-fluid borderless entity high video_'+a.media_id+'"><div class="span12"><iframe type="text/html" width="550" height="335" src="http://www.youtube.com/embed/'+a.media_id+'?autoplay=0&wmode=opaque&origin=http://rivermier.com" frameborder="0"></div></div>');$("#videos > .tweets").prepend('<div class="hide row-fluid borderless tweet tweet_'+a.tweet_id+'"><div class="span1 profile_picture"><img src="'+a.profile_image_url+'"/></div><div class="span10 relative"><strong><a href="https://twitter.com/'+a.screen_name+'" target="_blank" title="@'+a.screen_name+'">'+a.name+'</a></strong> <small class="username">@'+a.screen_name+'</small><span class="time" title="'+a.created_at+'"></span><div class="hide icons"><span class="reply"><span class="reply-icon twitter-icon"> </span> <a href="https://twitter.com/intent/tweet?in_reply_to='+a.tweet_id+'">Reply</a></span><span class="retweet"><span class="retweet-icon twitter-icon"> </span> <a href="https://twitter.com/intent/retweet?tweet_id='+a.tweet_id+'">Retweet</a></span><span class="favorite"><span class="favorite-icon twitter-icon"> </span> <a href="https://twitter.com/intent/favorite?tweet_id='+a.tweet_id+'">Favorite</a></span><span> . </span><span><a href="https://twitter.com/'+a.screen_name+"/status/"+a.tweet_id+'" target="_blank">Open</a></span></div><p class="tweet-text tweet_video_'+a.tweet_id+'"></p></div></div>');h("#videos > .tweets",".tweet_video_"+a.tweet_id,a.text);return false}function d(a){$("#media > .tweets").prepend('<div class="hide row-fluid tweet entity borderless high media_'+a.media_id+'"><div class="span12 crop"><a href="'+a.url+'" target="_blank"><img src="'+a.media_url+'"/></a></div></div>');$("#media > .tweets").prepend('<div class="hide row-fluid borderless tweet tweet_'+a.tweet_id+'"><div class="span1 profile_picture"><img src="'+a.profile_image_url+'"/></div><div class="span10 relative"><strong><a href="https://twitter.com/'+a.screen_name+'" target="_blank" title="@'+a.screen_name+'">'+a.name+'</a></strong> <small class="username">@'+a.screen_name+'</small><span class="time" title="'+a.created_at+'"></span><div class="hide icons"><span class="reply"><span class="reply-icon twitter-icon"> </span> <a href="https://twitter.com/intent/tweet?in_reply_to='+a.tweet_id+'">Reply</a></span><span class="retweet"><span class="retweet-icon twitter-icon"> </span> <a href="https://twitter.com/intent/retweet?tweet_id='+a.tweet_id+'">Retweet</a></span><span class="favorite"><span class="favorite-icon twitter-icon"> </span> <a href="https://twitter.com/intent/favorite?tweet_id='+a.tweet_id+'">Favorite</a></span><span> . </span><span><a href="https://twitter.com/'+a.screen_name+"/status/"+a.tweet_id+'" target="_blank">Open</a></span></div><p class="tweet-text tweet_media_'+a.tweet_id+'"></p></div></div>');h("#media > .tweets",".tweet_media_"+a.tweet_id,a.text);return false}function c(a,b){if(b==true){var c="#popular-tweets > .tweets"}else{var c="#trend-makers > .tweets"}$(c).prepend('<div class="hide row-fluid tweet tweet_'+a.tweet_id+'" tags="'+a.tags.join(" ")+'"><div class="span1 profile_picture"><img src="'+a.profile_image_url+'"/></div><div class="span10 relative"><strong><a href="https://twitter.com/'+a.screen_name+'" target="_blank" title="@'+a.screen_name+'">'+a.name+'</a></strong> <small class="username">@'+a.screen_name+'</small><span class="time" title="'+a.created_at+'"></span><div class="hide icons"><span class="reply"><span class="reply-icon twitter-icon"> </span> <a href="https://twitter.com/intent/tweet?in_reply_to='+a.tweet_id+'">Reply</a></span><span class="retweet"><span class="retweet-icon twitter-icon"> </span> <a href="https://twitter.com/intent/retweet?tweet_id='+a.tweet_id+'">Retweet</a></span><span class="favorite"><span class="favorite-icon twitter-icon"> </span> <a href="https://twitter.com/intent/favorite?tweet_id='+a.tweet_id+'">Favorite</a></span><span> . </span><span><a href="https://twitter.com/'+a.screen_name+"/status/"+a.tweet_id+'" target="_blank">Open</a></span></div><p class="tweet-text '+a.tweet_id+'"></p></div></div>');var d=false;$.each(a.tags,function(a,b){if($.inArray(b,$.rivermier.hide_tags)>-1){d=true}});h(c,"."+a.tweet_id,a.text,d);return false}function b(a){$.each(a.trends,function(a,b){$.rivermier.tags.push(b.replace(/\#/,""))});$.rivermier.tags=$.rivermier.tags.unique().sort();var b="";$.each($.rivermier.tags,function(a,c){b=b+'<a href="#" enabled="true">'+c+"</a> "});$("li#trends").replaceWith('<li id="trends" class="topics">'+b+"</li>");$(".trend-updated-at").replaceWith('<span class="trend-updated-at">( <span class="trend-time" title="'+a.time+'"></span> ago )</span>');$(".trend-time").timeago()}function a(a){$(".tweet_"+a.tweet_id).next(".entity").remove();$(".tweet_"+a.tweet_id).remove()}$('a[href="#/live-stream"]').click(function(){m("#today","#live-stream","#/live-stream");_gaq.push(["_trackPageview","/"]);return false});$('a[href="#/today"]').click(function(){m("#live-stream","#today","#/today");if($("#today > .sub-contents").length==0){$("#today").load("/today",function(){i("#today")})}_gaq.push(["_trackPageview","/today"]);return false});$("#today-photos-button").live("click",function(){if($("#today-photos > #photos-contents").length==0){$("#today-photos").load("/today-photos",function(){i("#today-photos");})}_gaq.push(["_trackPageview","/today-photos"]);return false});$("#today-videos-button").live("click",function(){if($("#today-videos > #videos-contents").length==0){$("#today-videos").load("/today-videos",function(){i("#today-videos")})}_gaq.push(["_trackPageview","/today-videos"]);return false});$("#today-links-button").live("click",function(){if($("#today-links > #links-contents").length==0){$("#today-links").load("/today-links",function(){$("#today-links").find(".link-headline > a").each(function(){if(l($(this).attr("href"))){$(this).closest(".link-box").addClass("thaana");$(this).closest(".link-box").find(".link-photo").attr("style","float:right")}});k()})}_gaq.push(["_trackPageview","/today-links"]);return false});$("#today-topics-button").live("click",function(){if($("#today-topics > #topics-contents").length==0){$("#today-topics").load("/today-topics",function(){i("#today-topics")})}_gaq.push(["_trackPageview","/today-topics"]);return false});$("#load-more-today-button").live("click",function(){$("#load-more-today-button").hide();$("#topics-contents > .tweets").append('<div class="loading"><div>Loading tweets...</div><img src="/assets/img/loading.gif" /></div>');var a=$("#load-more-today-button").attr("offset");var b=$("#load-more-today-button").attr("topic");url="/today-topics?topic="+b+"&offset="+a;$.get(url,function(a){$("#topics-contents > .tweets > .loading").remove();$("#topics-contents > .tweets").append(a);i("#today-topics")});return false});$(".trend-button").live("click",function(){$("#topics-contents > .tweets").empty();$("#topics-contents > .tweets").append('<div class="loading"><div>Loading tweets...</div><img src="/assets/img/loading.gif" /></div>');topic=$(this).attr("trend");offset=0;url="/today-topics?topic="+topic+"&offset="+offset;$.get(url,function(a){$("#topics-contents > .tweets").empty();$("#topics-contents > .tweets").append(a);i("#today-topics")});_gaq.push(["_trackEvent","/today-topics",topic]);return false});$("#today-people-button").live("click",function(){if($("#today-people > #people-contents").length==0){$("#today-people").load("/today-people",function(){k()})}_gaq.push(["_trackPageview","/today-people"]);return false});$("#trend-makers-button").click(function(){$(".trend-box").show();_gaq.push(["_trackPageview","/"])});$("#popular-tweets-button").click(function(){if($("#popular-tweets > .tweets").length==0){$("#popular-tweets").load("/retweets",function(){i("#popular-tweets > .tweets")});f.subscribe("retweets",function(a){c(jQuery.parseJSON(a),true)})}$(".trend-box").hide();_gaq.push(["_trackPageview","/retweets"])});$("#media-button").click(function(){if($("#media > .tweets").length==0){$("#media").load("/photos",function(){i("#media > .tweets")});f.subscribe("photos",function(a){d(jQuery.parseJSON(a))})}$(".trend-box").hide();_gaq.push(["_trackPageview","/photos"])});$("#videos-button").click(function(){if($("#videos > .tweets").length==0){$("#videos").load("/videos",function(){i("#videos > .tweets")});f.subscribe("videos",function(a){e(jQuery.parseJSON(a))})}$(".trend-box").hide();_gaq.push(["_trackPageview","/videos"])});$("#trends > a").live("click",function(){var a=$(this).text().toLowerCase().replace(/\#/,"");if($.rivermier.first==true){$("#trends > a").each(function(){var b=$(this).text().toLowerCase().replace(/\#/,"");if(b!=a){$(this).css("background-color","#ddd");$(this).attr("enabled","false");$.rivermier.hide_tags.push(b)}});$("#trend-makers > .tweets").find("div[tags]").hide();$("#trend-makers > .tweets").find("div[tags*='"+a+"']").show();$.rivermier.first=false}else{if($(this).attr("enabled")=="true"){$(this).css("background-color","#ddd");$(this).attr("enabled","false");$.rivermier.hide_tags.push(a);$("#trend-makers > .tweets").find("div[tags*='"+a+"']").hide()}else{$(this).css("background-color","");$(this).attr("enabled","true");$.rivermier.hide_tags.remove(a);$("#trend-makers > .tweets").find("div[tags*='"+a+"']").show()}}_gaq.push(["_trackPageview","/",a]);return false});/ * Site init */;$(".tweet-text").each(function(){var a=$(this).find(".original-text").text();j(this,a)});$(".trend-time").timeago();$(".time").timeago();k();$.rivermier={};$.rivermier.first=true;$.rivermier.hide_tags=new Array;$.rivermier.tags=new Array;$.rivermier.tags=$("#trends").attr("tags").split(" ");/ * Juggernaut */;var f=new Juggernaut({host:"stream.rivermier.com",port:80});f.subscribe("tweets",function(a){c(jQuery.parseJSON(a),false)});f.subscribe("trends",function(a){b(jQuery.parseJSON(a))});f.subscribe("deletes",function(b){a(jQuery.parseJSON(b))});f.subscribe("test",function(a){b(jQuery.parseJSON(a))});/ * Site methods */;$(".tweet").live("mouseenter",function(){$(this).find(".time").hide();$(this).find(".icons").show()});$(".tweet").live("mouseleave",function(){$(this).find(".icons").hide();$(this).find(".time").show()});$(".tweet").live("click",function(){$(this).find(".icons").toggle();$(this).find(".time").toggle()});Array.prototype.remove=function(a){var b=-1;while((b=this.indexOf(a))>-1){this.splice(b,1)}};Array.prototype.unique=function(){var a=this;var b=[];for(var c=a.length;c--;){var d=a[c];if($.inArray(d,b)===-1){b.unshift(d)}}return b}})